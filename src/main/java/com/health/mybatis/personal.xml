<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.health.mybatis">

    <select id="memberWishPosts" resultType="PostDto" parameterType="int">
        <!--        select p.postno as postNo, enterpriseNo,title,content, postimg as postImg,p.regDate as regDate,p.deletedDate as deletedDate from post p-->
        select p.postno as postNo, title, postimg from post p
        inner join (select * from member m
        inner join userlike u on m.userno = u.userno where m.userno = #{userNo}) mu
        on p.postno = mu.postno WHERE p.DELETEDDATE is null
    </select>
    <select id="memberInfo" resultType="MemberDto" parameterType="int">
        select * from member where userno = #{userNo}
    </select>
    <select id="memberPassword" resultType="String" parameterType="int">
        select pw from member where userno = #{userNo}
    </select>
    <update id="memWithdraw" parameterType="int">
        update member set deleteddate = sysdate where userno = #{userNo}
    </update>
    <update id="updateEnterprise" parameterType="EnterpriseDto">
        update enterprise set tel=#{tel}, ceo=#{ceo}, address=#{address}, addressDetail=#{addressDetail} where enterpriseNo = #{enterpriseNo}
    </update>
    <select id="enterpriseInfo" resultType="EnterpriseDto" parameterType="int">
        select * from enterprise where enterpriseNo = #{enterpriseNo}
    </select>
    <select id="enterprisePassword" resultType="String" parameterType="int">
        select pw from enterprise where enterpriseNo = #{enterpriseNo}
    </select>
    <update id="updateEntPassword" parameterType="EnterpriseDto">
        update enterprise set pw = #{pw} where enterpriseNo=#{enterpriseNo}
    </update>
    <update id="entWithdraw" parameterType="int">
        update enterprise set deleteddate = sysdate where enterpriseNo = #{enterpriseNo}
    </update>
    <update id="entProfileImg" parameterType="EnterpriseDto">
        update enterprise set profile = #{profile} where enterpriseNo = #{enterpriseNo}
    </update>
    <select id="entPosts" resultType="PostPageDto" parameterType="int">
        select rowNum, postNo, title, to_char(regDate,'yyyy.mm.dd') as regDate from post where enterpriseNo = #{no} and deletedDate is null
    </select>
<!--    member review 조회-->
    <select id="memReview" resultType="Map" parameterType="int">
        SELECT rownum, postimg, REVIEWNO, r.postno AS postno, r.title AS title,
        to_char(r.regdate, 'yyyy.mm.dd') AS regdate, p.title AS postTitle,
        p.DELETEDDATE AS postdeleteddate
        FROM REVIEW r INNER JOIN post p
        ON r.postno = p.postno WHERE r.DELETEDDATE IS NULL AND userno = #{no}
    </select>
</mapper>